<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"eth_account_AccountModel.js.html":{"id":"eth_account_AccountModel.js.html","title":"Source: eth/account/AccountModel.js","body":" EthInt Api Namespaces eth Modules accountcontracttransaction Classes account~AccountModelaccount~AccountServicecontract~ContractModelcontract~ContractServicetransaction~TransactionModeltransaction~TransactionServiceResponseServerExceptionsServerSetup Source: eth/account/AccountModel.js /*jslint node: true*/ /*globals Promise: true*/ /** @namespace eth */ /** @custom xxx */ 'use strict'; var xreq = require('xreq'), helpers = xreq.helpers('modelHelpers'), ObjectID = require('mongodb').ObjectID; /** @module account */ /** @custom xxx */ class AccountModel { /** * Model to handle the accounts collection * @param {Object} &quot;db&quot; - DI for database * @param {Object} &quot;i18n&quot; - DI for i18n * @param {Object} &quot;enume&quot; - DI for enum * @param {Object} &quot;moment&quot; - DI for moment * @param {Object} &quot;config&quot; - DI for config * @param {Object} &quot;ethHelper&quot; - DI for ethHelper * @constructor * @returns {Object} Returns a new AccountModel object. */ constructor (i18n, enume, moment, config, ethHelper) { //this.collection = db.collection(&quot;contracts&quot;); this.i18n = i18n; this.contract = {}; this.enum = enume; this.moment = moment; this.config = config; this.ethHelper = ethHelper; } /** * Returns account details * @public * @memberOf AccountModel * @param {string} account Account address * @custom public * @returns {Promise} Returns a new promise with the account detail. * @TODO serialize javascript object and store in cookie */ get (account) { const ethHelp = this.ethHelper; return new Promise(function (resolve, reject) { ethHelp.util.status().then(function(result){ ethHelp.trx.get(trxhash) .then(function (result) { resolve(result); }) .catch(function (error) { reject(error); }); }).catch(function (error) { reject(error); }); }); } } module.exports = AccountModel; × Search results Close "},"eth_contract_ContractModel.js.html":{"id":"eth_contract_ContractModel.js.html","title":"Source: eth/contract/ContractModel.js","body":" EthInt Api Namespaces eth Modules accountcontracttransaction Classes account~AccountModelaccount~AccountServicecontract~ContractModelcontract~ContractServicetransaction~TransactionModeltransaction~TransactionServiceResponseServerExceptionsServerSetup Source: eth/contract/ContractModel.js /*jslint node: true*/ /*globals Promise: true*/ /** @namespace eth */ /** @custom xxx */ 'use strict'; var xreq = require('xreq'), helpers = xreq.helpers('modelHelpers'), ObjectID = require('mongodb').ObjectID; /** @module contract */ /** @custom xxx */ class ContractModel { /** * Model to handle the contracts collection * @param {Object} &quot;db&quot; - DI for database * @param {Object} &quot;i18n&quot; - DI for i18n * @param {Object} &quot;enume&quot; - DI for enum * @param {Object} &quot;moment&quot; - DI for moment * @param {Object} &quot;config&quot; - DI for config * @param {Object} &quot;ethHelper&quot; - DI for ethHelper * @constructor * @returns {Object} Returns a new ContractModel object. */ constructor (i18n, enume, moment, config, ethHelper) { //this.collection = db.collection(&quot;contracts&quot;); this.i18n = i18n; this.contract = {}; this.enum = enume; this.moment = moment; this.config = config; this.ethHelper = ethHelper; } /** * Deploys a new contract in the Ethereum blockchain. * @public * @memberOf ContractModel * @param {string} contract Contract name * @param {string} sender Address of the sender, if null it will use the default one * @param {boolean} wait If set to true it will wait until the contract is mined. If not it will return the transactionHash straight away and some other process will have to monitor the status. * @custom public * @returns {Promise} Returns a new promise with the contract detail. */ deployContract (contract,sender,wait) { let compiled, abi; const ethHelp = this.ethHelper; return new Promise(function (resolve, reject) { ethHelp.util.status().then(function(result){ //ethHelp.account.default(sender); ethHelp.contract.get(contract + '.sol') .then(function (result) { return ethHelp.util.compile(result); }) .then(function (result) { compiled = helpers.json.getFirst(result); abi = compiled.info.abiDefinition; // Check ethHelp.contract.saveAbi(contract,abi); // create contract return ethHelp.contract.new(contract,compiled.code,abi,'0xe24591bb87d2e7edc97c340221c85b1c03ca33e8',wait); }) .then(function (result) { resolve(result); }) .catch(function (error) { reject(error); }); }).catch(function (error) { reject(error); }); }); } /** * Executes a message call transaction, which is directly executed in the VM of the node, but never mined into the blockchain. * @public * @memberOf ContractModel * @param {string} contract Contract name * @param {string} sender Address of the sender, if null it will use the default one * @param {boolean} wait If set to true it will wait until the contract is mined. If not it will return the transactionHash straight away and some other process will have to monitor the status. * @custom public * @returns {Promise} Returns a new promise with the contract detail. */ call (contract,address,sender,data,wait) { const ethHelp = this.ethHelper; return new Promise(function (resolve, reject) { ethHelp.util.status().then(function(result){ ethHelp.contract.get(contract) .then(function (result) { //TODO DO WE NEED THIS? return ethHelp.contract.instance(contract,address); }) .then(function (result) { ethHelp.account.default(sender); return ethHelp.trx.call(address,data); }) .then(function (result) { resolve(result); }) .catch(function (error) { reject(error); }); }).catch(function (error) { reject(error); }); }); } /** * Sends a transaction to the network. * @public * @memberOf ContractModel * @param {string} contract Contract name * @param {string} sender Address of the sender, if null it will use the default one * @param {boolean} wait If set to true it will wait until the contract is mined. If not it will return the transactionHash straight away and some other process will have to monitor the status. * @custom public * @returns {Promise} Returns a new promise with the contract detail. */ sendTransaction (contract,sender,wait) { const ethHelp = this.ethHelper; return new Promise(function (resolve, reject) { ethHelp.util.status().then(function(result){ ethHelp.trx.send(contract) .then(function (result) { resolve(result); }) .catch(function (error) { reject(error); }); }).catch(function (error) { reject(error); }); }); } } module.exports = ContractModel; × Search results Close "},"eth_contract_ContractService.js.html":{"id":"eth_contract_ContractService.js.html","title":"Source: eth/contract/ContractService.js","body":" EthInt Api Namespaces eth Modules accountcontracttransaction Classes account~AccountModelaccount~AccountServicecontract~ContractModelcontract~ContractServicetransaction~TransactionModeltransaction~TransactionServiceResponseServerExceptionsServerSetup Source: eth/contract/ContractService.js /*jslint node: true*/ /** @namespace eth */ /** @custom xxx */ 'use strict'; var Exceptions, xcatalog, moment, xreq = require('xreq'), Validator = xreq.utils('Validator'); /** @module contract */ /** @custom xxx */ class ContractService { /** * Service that will handle payments lifecycle * @param {Object} &quot;exceptions&quot; - DI for exceptions * @constructor * @returns {Object} Returns a new ContractService service object. */ constructor (catalog, moment, i18n, enume, exceptions, contractModel) { Exceptions = exceptions; xcatalog = catalog; moment = moment; this.i18n = i18n; this.model = contractModel; this.enume = enume; } /** * Deploys a new contract in the Ethereum blockchain. * @memberOf EthContractService * @param {string} contract Contract name * @param {string} sender Address of the sender, if null it will use the default one * @param {boolean} wait If set to true it will wait until the contract is mined. If not it will return the transactionHash straight away and some other process will have to monitor the status. * @custom public * @returns {string} Returns the transaction hash id of the contract deployment */ deployContract(contract,sender,wait) { let itself = this; return new Promise(function (resolve, reject) { var validator = new Validator({ contract : contract, wait: wait}); validator.path('contract', ['string', 'required']); validator.path('wait', ['boolean', 'required']); if (validator.hasErrors()) { let vErrors = validator.getErrors(); reject(new Exceptions.Validation(vErrors) ); return; } else { return itself.model.deployContract(contract,sender,wait) .then(function(response){ resolve(response); },function(err){ reject(err); }) .catch(function(err){ reject(err); }); } }); } /** * Sends coins from the coinbase to the passed account. * @memberOf EthContractService * @param {string} contractAddress Contract's address. * @param {string} receiverAddress Address to receive the coins. * @param {string} value Number of coins to transfer. * @custom public */ contractCall(contractAddress,fromAddress,receiverAddress,value,waitUntilMined) { let itself = this; return new Promise(function (resolve, reject) { var validator = new Validator({ contract : contract, wait: wait}); validator.path('contract', ['string', 'required']); validator.path('wait', ['boolean', 'required']); if (validator.hasErrors()) { let vErrors = validator.getErrors(); reject(new Exceptions.Validation(vErrors) ); return; } else { return itself.model.deployContract(contract,sender,wait) .then(function(response){ resolve(response); },function(err){ reject(err); }) .catch(function(err){ reject(err); }); } }); // XXXXXXXXXXXXXXX var deferred = Q.defer(); utilSrv.getContractOrAbi('IsbanCoin.sol.abi') .then(function (result) { var abi = JSON.parse(result), contractInstance = web3.eth.contract(abi), isbanCoinContract = contractInstance.at(contractAddress), primaryAddress = web3.eth.accounts[0]; console.log('send coins, value: ' + value + ', from: ' + fromAddress + ' to ' + receiverAddress); // send a transaction to a function isbanCoinContract.sendRed(fromAddress,receiverAddress, value, { from: primaryAddress, gas: cfg.contractGas }, function (err, result) { console.log('result send coins',result); if(err) { deferred.reject(err); } else { deferred.resolve(result); dbSrv.addLog('sendcoinsred',value + ' red coins','eth',fromAddress,receiverAddress,contractAddress,result,value); } }); }) .fail(function (error) { deferred.reject(error); }); return deferred.promise; } } module.exports = ContractService; × Search results Close "},"eth_transaction_TransactionModel.js.html":{"id":"eth_transaction_TransactionModel.js.html","title":"Source: eth/transaction/TransactionModel.js","body":" EthInt Api Namespaces eth Modules accountcontracttransaction Classes account~AccountModelaccount~AccountServicecontract~ContractModelcontract~ContractServicetransaction~TransactionModeltransaction~TransactionServiceResponseServerExceptionsServerSetup Source: eth/transaction/TransactionModel.js /*jslint node: true*/ /*globals Promise: true*/ /** @namespace eth */ /** @custom xxx */ 'use strict'; var xreq = require('xreq'), helpers = xreq.helpers('modelHelpers'), ObjectID = require('mongodb').ObjectID; /** @module transaction */ /** @custom xxx */ class TransactionModel { /** * Model to handle the transactions collection * @param {Object} &quot;db&quot; - DI for database * @param {Object} &quot;i18n&quot; - DI for i18n * @param {Object} &quot;enume&quot; - DI for enum * @param {Object} &quot;moment&quot; - DI for moment * @param {Object} &quot;config&quot; - DI for config * @param {Object} &quot;ethHelper&quot; - DI for ethHelper * @constructor * @returns {Object} Returns a new TransactionModel object. */ constructor (i18n, enume, moment, config, ethHelper) { //this.collection = db.collection(&quot;contracts&quot;); this.i18n = i18n; this.contract = {}; this.enum = enume; this.moment = moment; this.config = config; this.ethHelper = ethHelper; } /** * Returns the transaction detail for a certain id * @public * @memberOf TransactionModel * @param {string} trxhash Transaction identifier * @custom public * @returns {Promise} Returns a new promise with the transaction detail. */ get (trxhash) { const ethHelp = this.ethHelper; return new Promise(function (resolve, reject) { ethHelp.util.status().then(function(result){ ethHelp.trx.get(trxhash) .then(function (result) { resolve(result); }) .catch(function (error) { reject(error); }); }).catch(function (error) { reject(error); }); }); } } module.exports = TransactionModel; × Search results Close "},"eth_account_AccountService.js.html":{"id":"eth_account_AccountService.js.html","title":"Source: eth/account/AccountService.js","body":" EthInt Api Namespaces eth Modules accountcontracttransaction Classes account~AccountModelaccount~AccountServicecontract~ContractModelcontract~ContractServicetransaction~TransactionModeltransaction~TransactionServiceResponseServerExceptionsServerSetup Source: eth/account/AccountService.js /*jslint node: true*/ /** @namespace eth */ /** @custom xxx */ 'use strict'; var Exceptions, xcatalog, moment, xreq = require('xreq'), Validator = xreq.utils('Validator'); /** @module account */ /** @custom xxx */ class AccountService { /** * Service that will handle acount lifecycle * @param {Object} &quot;exceptions&quot; - DI for exceptions * @constructor * @returns {Object} Returns a new AccountService service object. */ constructor (catalog, moment, i18n, enume, exceptions, accountModel) { Exceptions = exceptions; xcatalog = catalog; moment = moment; this.i18n = i18n; this.model = transactionModel; this.enume = enume; } /** * Gets account details. * @memberOf EthAccService * @param {trxhash} trxhash Transaction identifier * @custom public */ get(trxhash) { let itself = this; return new Promise(function (resolve, reject) { return itself.model.get(trxhash) .then(function(response){ if (response) { resolve(response); } else { reject('Transaction not found'); } },function(err){ reject(err); }) .catch(function(err){ reject(err); }); }); } } module.exports = AccountService; × Search results Close "},"eth_transaction_TransactionService.js.html":{"id":"eth_transaction_TransactionService.js.html","title":"Source: eth/transaction/TransactionService.js","body":" EthInt Api Namespaces eth Modules accountcontracttransaction Classes account~AccountModelaccount~AccountServicecontract~ContractModelcontract~ContractServicetransaction~TransactionModeltransaction~TransactionServiceResponseServerExceptionsServerSetup Source: eth/transaction/TransactionService.js /*jslint node: true*/ /** @namespace eth */ /** @custom xxx */ 'use strict'; var Exceptions, xcatalog, moment, xreq = require('xreq'), Validator = xreq.utils('Validator'); /** @module transaction */ /** @custom xxx */ class TransactionService { /** * Service that will handle payments lifecycle * @param {Object} &quot;exceptions&quot; - DI for exceptions * @constructor * @returns {Object} Returns a new TransactionService service object. */ constructor (catalog, moment, i18n, enume, exceptions, transactionModel) { Exceptions = exceptions; xcatalog = catalog; moment = moment; this.i18n = i18n; this.model = transactionModel; this.enume = enume; } /** * Checks whether the Ethereum node is up and running or not. * @memberOf EthTrxService * @param {string} name Contract name. For example. 'MyCoin'. * @custom public */ get(trxhash) { let itself = this; return new Promise(function (resolve, reject) { return itself.model.get(trxhash) .then(function(response){ if (response) { resolve(response); } else { reject('Transaction not found'); } },function(err){ reject(err); }) .catch(function(err){ reject(err); }); }); } } module.exports = TransactionService; × Search results Close "},"struct_Response.js.html":{"id":"struct_Response.js.html","title":"Source: struct/Response.js","body":" EthInt Api Namespaces eth Modules accountcontracttransaction Classes account~AccountModelaccount~AccountServicecontract~ContractModelcontract~ContractServicetransaction~TransactionModeltransaction~TransactionServiceResponseServerExceptionsServerSetup Source: struct/Response.js 'use strict'; const e = require('./../../../lib/enum'); /** Creates a new Response object. @constructor */ function Response(status,code,data,message,error) { /** Initialization */ /** * Code of the response * @type {collection} */ if (error) { this.body = { status: status, error: { code: (error.code) ? error.code : e.http.status.internalerror, type: error.type, message: error.message } }; } else { this.body = { status: status, code: code, message: message }; } if (data) { this.body.data = data; } } /** Get response body */ Response.prototype.getData = function() { return this.body.data; }; /** Get code */ Response.prototype.getCode = function() { return this.body.code; }; /** Get Message */ Response.prototype.getMessage = function() { return this.body.message; }; /** Get Error */ Response.prototype.getStatus = function() { return this.body.status; }; /** Export the class */ module.exports = Response; × Search results Close "},"exception_ServerExceptions.js.html":{"id":"exception_ServerExceptions.js.html","title":"Source: exception/ServerExceptions.js","body":" EthInt Api Namespaces eth Modules accountcontracttransaction Classes account~AccountModelaccount~AccountServicecontract~ContractModelcontract~ContractServicetransaction~TransactionModeltransaction~TransactionServiceResponseServerExceptionsServerSetup Source: exception/ServerExceptions.js /*jslint node: true*/ &quot;use strict&quot;; class ServerExceptions { /** * Class that will handle Restify exceptions * @param {Object} &quot;i18n&quot; - DI for i18n * @param {Object} &quot;restify&quot; - DI for restify * @param {Object} &quot;logger&quot; - DI for logger * @param {Object} &quot;util&quot; - DI for util * @param {Object} &quot;exceptions&quot; - DI for exceptions * @constructor * @returns {Object} Returns a new ServerExceptions object. */ constructor ( i18n, restify, logger, util, exceptions) { this.i18n = i18n; this.restify = restify; this.logger = logger; this.util = util; this.exceptions = exceptions; //this.util.inherits(this.restify.RestError); } /** * Generates a new restify exception based on err instance * @public * @memberOf ServerExceptions * @param {object} error, Error object * @custom public * @example &lt;caption&gt;Error types:&lt;/caption&gt; * Base: ServiceException, * AccessDenied: AccessDeniedException, * NotFound: NotFoundException, * Validation: ValidationException, * Internal: InternalException * @returns {object} Returns a new restify exception object. */ createException (error, req){ if(error instanceof this.exceptions.Validation){ req.log.debug('Validation error: %s', error); return new this.restify.InvalidArgumentError( this.i18n.__('ValidationError') + ' '+ this.util.inspect(error.errors) ); } if(error instanceof this.exceptions.AccessDenied){ req.log.debug('The access was denied to the resoruce you are trying to access %s', error); return new this.restify.NotAuthorizedError( this.i18n.__('AccessDeniedError') + ' '+ this.util.inspect(error) ); } if(error instanceof this.exceptions.NotFound){ req.log.warn('Resouce not found exception: %s', error); return new this.restify.ResourceNotFoundError ( this.i18n.__('NotFoundError') + &quot; on &quot; + error.collection + &quot; &quot; + error.resource ); } if(error instanceof this.exceptions.Internal){ req.log.info('There was an internal server error %s', error); return new this.restify.InternalServerError( this.i18n.__('InternalError') + ' '+ this.util.inspect(error) ); } if(error instanceof this.exceptions.Base){ req.log.info('There was a problem processing your request %s', error); return new this.restify.InternalServerError( this.i18n.__('BaseError') + ' '+ this.util.inspect(error) ); } req.log.info('There was an internal server error %s', error); return new this.restify.InternalServerError( this.i18n.__('OtherError') + ' '+ this.util.inspect(error) ); } createServerErrorException (errors, req){ req.log.info('There was an internal server error %s', errors); return new this.restify.InternalServerError( this.i18n.__('OtherError') + ' '+ this.util.inspect(errors) ); } createValidationException (errors, req){ req.log.debug('Validation error: %s', errors); return new this.restify.InvalidArgumentError( this.i18n.__('ValidationError') + ' '+ this.util.inspect(errors) ); } createInvalidCredentialsException(errors, req){ req.log.debug('InvalidCredentialsError: %s', errors.toString()); return new this.restify.InvalidCredentialsError( errors.toString() ); } logException (error){ } /** * Returns the error type (instanceof or constructor name) * @public * @memberOf ServerExceptions * @param {object} error, Error object * @custom public * @returns {string} instanceof or constructor name. */ getExceptionInstanceOf (error){ if(error instanceof this.exceptions.Validation) return &quot;ValidationException&quot;; if(error instanceof this.exceptions.AccessDenied) return &quot;AccessDeniedException&quot;; if(error instanceof this.exceptions.NotFound) return &quot;NotFoundException&quot;; if(error instanceof this.exceptions.Internal) return &quot;InternalException&quot;; if(error instanceof this.exceptions.Base) return &quot;ServiceException&quot;; return error.constructor.name; } } module.exports = ServerExceptions; × Search results Close "},"server.js.html":{"id":"server.js.html","title":"Source: server.js","body":" EthInt Api Namespaces eth Modules accountcontracttransaction Classes account~AccountModelaccount~AccountServicecontract~ContractModelcontract~ContractServicetransaction~TransactionModeltransaction~TransactionServiceResponseServerExceptionsServerSetup Source: server.js /*jslint node: true*/ 'use strict'; const YES = 'yes', ROUTER = 'Router', AUDIT = 'AUDIT', LOG = 'LOG', PREFIX_API = '/api', request = require('request'), rc = require('restify-conductor'), semver = require('semver'), auditlogger = require('bunyan') ; /** * Service that will manage the creation of new API servers * @param {Object} 'restify' - DI for restify * @param {Object} 'logger' - DI for logger * @param {Object} 'util' - DI for util * @param {Object} 'app_name' - DI for app_name * @param {Object} 'app_version' - DI for app_version * @constructor * @returns {Object} Returns a new ServerSetup service object. */ function ServerSetup(restify, logger, util, xcatalog, app_name, app_version, exceptions) { // Service has to be called as contained dependency not as isolated function if (!(this instanceof ServerSetup)) { throw new Error('Used as a function'); } this.restify = restify; this.logger = logger; this.util = util; this.xcatalog = xcatalog; this.app_name = app_name; this.app_version = app_version; this.exceptions = exceptions; } /** * @public * @memberOf ServerSetup * @param {Object} 'config' - Configuration object for the new API server * @example &lt;caption&gt;Example usage of createAPIServer&lt;/caption&gt; * var server = serverSetup.createAPIServer(config); * @returns {Object} Returns a new API server. */ ServerSetup.prototype.createAPIServer = function(config) { var config = config; var restify = this.restify; var logger = this.logger; var util = this.util; var xcatalog = this.xcatalog; var app_name = this.app_name; var app_version = this.app_version; var exceptions = this.exceptions; var server; /** * @private * @memberOf ServerSetup * Applies API global headers to avoid caching * @returns {Void} */ var noCacheMiddleware = function noCacheMiddleware(req, res, next) { res.header('Cache-Control', 'no-cache, no-store, must-revalidate'); res.header('Pragma', 'no-cache'); res.header('Expires', 0); next(); } /** * @private * @memberOf ServerSetup * Sets up all api routes in the new API server * @returns {Void} */ var setupPreHandlers = function setupPreHandlers () { server.pre(restify.pre.sanitizePath()); server.pre(function (req, res, next) { req.url = req.url.replace(PREFIX_API, ''); var pieces = req.url.replace(/^\\/+/, '').split('/'); var version = pieces[0]; version = version.replace(/v(\\d{1})\\.(\\d{1})\\.(\\d{1})/, '$1.$2.$3'); version = version.replace(/v(\\d{1})\\.(\\d{1})/, '$1.$2.0'); version = version.replace(/v(\\d{1})/, '$1.0.0'); if (semver.valid(version)) { req.url = req.url.replace(pieces[0], ''); req.headers = req.headers || []; req.headers['accept-version'] = version; } else { if (req.url!='/') { return next(new restify.InvalidVersionError('This is an invalid version')); } } next(); }); return; } /** * @private * @memberOf ServerSetup * Sets up all API routes in the new API server * @returns {Void} */ var setupRoutes = function setupRoutes () { config.routers.map( item =&gt; xcatalog(item + 'Router') ) return; } /** * @private * @memberOf ServerSetup * Sets up parsing, zipping, logging,... * @returns {Void} */ var setupUses = function use () { server.use(restify.acceptParser(server.acceptable )); server.use(restify.queryParser()); server.use(restify.bodyParser()); server.use(restify.gzipResponse()); server.use(restify.fullResponse()); server.use(restify.requestLogger({})); server.use(noCacheMiddleware); return; } /** * @private * @memberOf ServerSetup * Sets up a root route for heartbeat * @returns {Void} */ var setUpHeartBeat = function setUpHeartBeat () { var heartbeatConductor = rc.createConductor({ name: 'heartbeatConductor', handlers: [ function render(req, res, next) { res.json( {name: app_name , version: app_version , date: new Date() }); return next(); } ] }); rc.get('/', heartbeatConductor, server); return; } /** * @private * @memberOf ServerSetup * Sets up an auditer instance to write audit logs * @returns {Void} */ var setUpAuditer = function setUpAuditer () { server.on('after', restify.auditLogger({ log: auditlogger.createLogger({ name: app_name + AUDIT, streams: [{ type: 'rotating-file', path: './'+ config.log.path +'/'+ app_name +'_'+ AUDIT +'.log', period: config.log.rotation_period, // daily rotation count: config.log.back_copies_count // back copies }] }) })); return; } /** * @private * @memberOf ServerSetup * Sets up a static server for documentation files * @returns {Void} */ var setUpStaticDocServer = function setUpStaticDocServer () { server.get(/\\/docs\\/v1\\/?.*/, restify.serveStatic({ directory: __dirname + '../../../', default: 'index.html' })) } /** * @private * @memberOf ServerSetup * Sets up a static server for swagger files * @returns {Void} */ var setUpSwaggerServer = function setUpSwaggerServer () { server.get(/\\/swagger\\/dist\\/?.*/, restify.serveStatic({ directory: __dirname + '../../../', default: 'index.html' })) } /** * @private * @memberOf ServerSetup * Returns a formatted json object for error response * @returns {Object} body object for the json response */ var formartErrorResponse = function formartErrorResponse (body) { let message = (body.message === '')?body.we_cause:body.message; let error = null; if(message instanceof Error){ if(message.name) message = 'Error: '+ message.name; if(body.name) message += ' '+ body.name; } let doc = { status: 'error', message: message, code: body.statusCode, body: body.body }; if(body.restCode){ doc.restCode = body.restCode } if(body.name){ doc.name = body.name } if(doc.body.message === '') doc.body.message = message; if(doc.message === '') doc.message = message; return doc; } /** * @private * @memberOf ServerSetup * Returns a formatted json object for standard response * @returns {Object} body object for the json response */ var formartResponse = function formartResponse (body) { return body = { code: 200, status: 'success', body: body }; } /** * @private * @memberOf ServerSetup * Returns global formatters for json I/O * @returns {Object} json object for the response formatters */ var getJsonFormaters = function getJsonFormaters () { return { 'application/json': function formatJson(req, res, body, cb) { //error response formatter if (body instanceof Error){ return cb(null, util.inspect(formartErrorResponse(body))); } if (Buffer.isBuffer(body)){ return cb(null, formartResponse(body)); } return cb(null, JSON.stringify(formartResponse(body), null, 2)); } } } /** * @private * @memberOf ServerSetup * Returns a configuration object for restify server start up based on config * @returns {Object} Returns a server properties object. */ var createServerPropObject = function createServerPropObject (config, name, version) { // base object for any of the 2 allowed protocols var oServerProp = { name: name, version: version, formatters: getJsonFormaters() }; // set up certs if HTTPS server if(config.protocol === 'HTTPS'){ //Adding certs for secure server if (config.tsl.cert) oServerProp.certificate = fs.readFileSync(this.config.tsl.cert); if (config.tsl.key) oServerProp.key = fs.readFileSync(this.config.tsl.key); } // if logging enabled, create a new logger instance if(config.log.enabled === true){ oServerProp.log = logger.createLogger({ name: app_name + LOG, streams: [{ type: 'rotating-file', src: true, path: './'+ config.log.path +'/'+ app_name +'_'+ LOG +'.log', period: config.log.rotation_period, // daily rotation count: config.log.back_copies_count // back copies }], level: config.log.level }); } oServerProp.log.info('Server started with log level %s', config.log.level); return oServerProp; } /** * @private * @memberOf ServerSetup * Applies septup sections based on config * @returns {Object} Returns a restify server object. */ var configServer = function configServer(){ // handlers that run before routing occurs setupPreHandlers(); // Common api calls handlers setupUses(); //Define heartbeat routes setUpHeartBeat(); //Add all routes setupRoutes(); //If audit requested, enable auditer if(config.log.audit === YES) setUpAuditer(); if (config.documentation.enabled === true) { setUpStaticDocServer(); setUpSwaggerServer(); } //When server is ready, start it up startServer(); return server; } /** * @private * @memberOf ServerSetup * Starts a newly created API server to listen in configured port * @returns {Promise} Returns a promise that will be resolved when server is listening. */ var startServer = function startServer () { return server.listen(config.port, function () { console.log(config.protocol + ' Server listening on port: ' + config.port); }); } /** * @private * @memberOf ServerSetup * Creates a new API server (protocol based) and configures it * @returns {Object} Returns a restify server object to be configured and started. */ var createServer = function createServer () { if (config.protocol === 'HTTPS') { server = restify.createServer(createServerPropObject(config, app_name, app_version)); xcatalog.set('apiserver', 'constant', server); configServer(server); } else if (config.protocol === 'HTTP') { server = restify.createServer(createServerPropObject(config, app_name, app_version)); xcatalog.set('apiserver', 'constant', server); configServer(server); } else { throw new TypeError('Missing protocol or invalid value: ' + config.protocol); } return server; } return createServer(server); } module.exports = ServerSetup; × Search results Close "},"util_Validator.js.html":{"id":"util_Validator.js.html","title":"Source: util/Validator.js","body":" EthInt Api Namespaces eth Modules accountcontracttransaction Classes account~AccountModelaccount~AccountServicecontract~ContractModelcontract~ContractServicetransaction~TransactionModeltransaction~TransactionServiceResponseServerExceptionsServerSetup Source: util/Validator.js /*jslint node: true*/ 'use strict'; const moment = require('moment'); class Validator { constructor (obj, prop) { this.obj = obj; this.errors = []; this.props = []; } push (path, constrain, value) { this.errors.push({ path: path, constrain: constrain, value: value }); } getErrors () { return this.errors.concat(this.props.reduce(function (result, prop) { prop.ref.getErrors().forEach(function (error) { result.push({ path: prop.path + '.' + error.path, constrain: error.constrain, value: error.value }); }); return result; }, [])); } hasErrors () { return !!this.errors.length || this.props.some((prop) =&gt; prop.ref.hasErrors()); } prop (prop) { let validator = new Validator(this.obj[prop]); this.props.push({ path: prop, ref: validator }); return validator; } /** * Validate a path. * required: default true; */ path (path, methods, required) { let itself = this, value = this.obj[path]; required = (required !== false); if (!Validator.required(value)) { if (required) { itself.push(path, 'required', value); } return !required; } return methods.every(function (method) { var result = Validator.validate(method, value); if (!result) { itself.push(path, method, value); } return result; }); } arraypath (path, methods, required) { let itself = this, values = this.obj[path]; required = (required !== false); return values.every(function (value, index) { if (!Validator.required(value)) { if (required) { itself.push(path + '[' + index + ']', 'required', value); } return !required; } return methods.every(function (method) { let result = Validator.validate(method, value); if (!result) { itself.push(path + '[' + index + ']', method, value); } return result; }); }); } } /* Validation methods */ Validator.isoDate = (str) =&gt; moment(str, 'YYYY-MM-DD', true).isValid(); Validator.gte = (a, value) =&gt; value &gt;= a; Validator.lte = (a, value) =&gt; value &lt;= a; Validator.gt = (a, value) =&gt; value &gt; a; Validator.lt = (a, value) =&gt; value &lt; a; Validator.enum = (list, value) =&gt; list.indexOf(value) !== -1; Validator.string = (value) =&gt; typeof value === 'string'; Validator.minLength = (min, value) =&gt; value.length &gt;= min; Validator.maxLength = (max, value) =&gt; value.length &lt;= max; Validator.equal = (expected, value) =&gt; expected === value; Validator.number = (value) =&gt; typeof value === 'number'; Validator.boolean = (value) =&gt; typeof value === 'boolean'; Validator.array = (value) =&gt; Array.isArray(value); Validator.noDuplicates = (values) =&gt; values.every( (value, index, array) =&gt; array.indexOf(value) === index ); /*jslint bitwise: true*/ Validator.integer = (value) =&gt; value === +value &amp;&amp; value === (value | 0); /*jslint bitwise: false*/ Validator.range = (min, max, value) =&gt; value &gt;= min &amp;&amp; value &lt;= max; Validator.required = (value) =&gt; value !== undefined &amp;&amp; !Number.isNaN(value) &amp;&amp; value !==null; Validator.notNaN = (value) =&gt; !Number.isNaN(value); Validator.undefined = (value) =&gt; value === undefined; Validator.pattern = (re, value) =&gt; re.test(value); Validator.validate = function (method, value) { let result; if (Array.isArray(method)) { //Better performance than apply switch (method.length) { case 2: result = Validator[method[0]](method[1], value); break; case 3: result = Validator[method[0]](method[1], method[2], value); break; default: throw new TypeError('Invalid number of arguments'); } } else if (typeof method === 'string') { result = Validator[method](value); } else { throw new TypeError('Invalid method type'); } return result; }; module.exports = Validator; × Search results Close "},"modules.list.html":{"id":"modules.list.html","title":"Modules","body":" EthInt Api Namespaces eth Modules accountcontracttransaction Classes account~AccountModelaccount~AccountServicecontract~ContractModelcontract~ContractServicetransaction~TransactionModeltransaction~TransactionServiceResponseServerExceptionsServerSetup Modules Classes AccountModel AccountService ContractModel ContractService TransactionModel TransactionService Response ServerExceptions ServerSetup Namespaces eth eth eth eth eth eth × Search results Close "},"classes.list.html":{"id":"classes.list.html","title":"Classes","body":" EthInt Api Namespaces eth Modules accountcontracttransaction Classes account~AccountModelaccount~AccountServicecontract~ContractModelcontract~ContractServicetransaction~TransactionModeltransaction~TransactionServiceResponseServerExceptionsServerSetup Classes Classes AccountModel AccountService ContractModel ContractService TransactionModel TransactionService Response ServerExceptions ServerSetup Namespaces eth eth eth eth eth eth × Search results Close "},"namespaces.list.html":{"id":"namespaces.list.html","title":"Namespaces","body":" EthInt Api Namespaces eth Modules accountcontracttransaction Classes account~AccountModelaccount~AccountServicecontract~ContractModelcontract~ContractServicetransaction~TransactionModeltransaction~TransactionServiceResponseServerExceptionsServerSetup Namespaces Classes AccountModel AccountService ContractModel ContractService TransactionModel TransactionService Response ServerExceptions ServerSetup Namespaces eth eth eth eth eth eth × Search results Close "},"index.html":{"id":"index.html","title":"Index","body":" EthInt Api Namespaces eth Modules accountcontracttransaction Classes account~AccountModelaccount~AccountServicecontract~ContractModelcontract~ContractServicetransaction~TransactionModeltransaction~TransactionServiceResponseServerExceptionsServerSetup Middleware nodejs piece that interfaces with the Ethereum RPC Api. Version0.0.2 TechPrerequisites node.js &gt; 4.x git Deployment checklist Install or update prerequisites (Only once) Download the source (Only once) Set environment Checkout a tag/version Configure app (certificates, secrets for enviromnent...) Install dependencies Start the app DownloadFor deployment (read only, public access) git cloneFor development (full access, auth. users) git cloneCheckout an specific tagExecute this commands in the app folder git fecth # update local repository git checkout v1.0.0 # checkout version v1.0.0Set environmentChoose one: # Local development export NODE_ENV=development #MACPRO-DEV export NODE_ENV=development # Preproduction and pilot export NODE_ENV=preproduction # Production and pre-production export NODE_ENV=productionInstall dependenciesChoose one: # Without proxy npm install # Proxy HTTP_PROXY=http://your-proxy:8080 npm installThis process also execute build after install all the dependencies Setup and data migration(This is no required, It is done by npm install post hook) Choose one: npm run setupWARNING: setup must be executed with the same environment as the application process. Service testsEnvironment should be set at this point npm testStart serverChoose one: #Local development - monitor server changes and restart nodemon # Install it with &quot;npm install -g nodemon&quot; #local UI development npm start #Audit can be enabled by changing default value for &quot;audit&quot; in configuration files × Search results Close "},"eth.html":{"id":"eth.html","title":"Namespace: eth","body":" EthInt Api Namespaces eth Modules accountcontracttransaction Classes account~AccountModelaccount~AccountServicecontract~ContractModelcontract~ContractServicetransaction~TransactionModeltransaction~TransactionServiceResponseServerExceptionsServerSetup Namespace: eth eth Source: eth/contract/ContractService.js, line 2 Namespace: eth eth Source: eth/transaction/TransactionModel.js, line 3 Namespace: eth eth Source: eth/account/AccountModel.js, line 3 Namespace: eth eth Source: eth/contract/ContractModel.js, line 3 Namespace: eth eth Source: eth/account/AccountService.js, line 2 Namespace: eth eth Source: eth/transaction/TransactionService.js, line 2 × Search results Close "},"module-account.html":{"id":"module-account.html","title":"Module: account","body":" EthInt Api Namespaces eth Modules accountcontracttransaction Classes account~AccountModelaccount~AccountServicecontract~ContractModelcontract~ContractServicetransaction~TransactionModeltransaction~TransactionServiceResponseServerExceptionsServerSetup Module: account Source: eth/account/AccountModel.js, line 12 Classes AccountModel AccountService Module: account Source: eth/account/AccountService.js, line 14 Classes AccountModel AccountService × Search results Close "},"module-account-AccountModel.html":{"id":"module-account-AccountModel.html","title":"Class: AccountModel","body":" EthInt Api Namespaces eth Modules accountcontracttransaction Classes account~AccountModelaccount~AccountServicecontract~ContractModelcontract~ContractServicetransaction~TransactionModeltransaction~TransactionServiceResponseServerExceptionsServerSetup Class: AccountModel account~ AccountModel new AccountModel(&quot;db&quot;, &quot;i18n&quot;, &quot;enume&quot;, &quot;moment&quot;, &quot;config&quot;, &quot;ethHelper&quot;) Model to handle the accounts collection Parameters: Name Type Description &quot;db&quot; Object DI for database &quot;i18n&quot; Object DI for i18n &quot;enume&quot; Object DI for enum &quot;moment&quot; Object DI for moment &quot;config&quot; Object DI for config &quot;ethHelper&quot; Object DI for ethHelper Source: eth/account/AccountModel.js, line 14 × Search results Close "},"module-account-AccountService.html":{"id":"module-account-AccountService.html","title":"Class: AccountService","body":" EthInt Api Namespaces eth Modules accountcontracttransaction Classes account~AccountModelaccount~AccountServicecontract~ContractModelcontract~ContractServicetransaction~TransactionModeltransaction~TransactionServiceResponseServerExceptionsServerSetup Class: AccountService account~ AccountService new AccountService(&quot;exceptions&quot;) Service that will handle acount lifecycle Parameters: Name Type Description &quot;exceptions&quot; Object DI for exceptions Source: eth/account/AccountService.js, line 16 × Search results Close "},"module-contract.html":{"id":"module-contract.html","title":"Module: contract","body":" EthInt Api Namespaces eth Modules accountcontracttransaction Classes account~AccountModelaccount~AccountServicecontract~ContractModelcontract~ContractServicetransaction~TransactionModeltransaction~TransactionServiceResponseServerExceptionsServerSetup Module: contract Source: eth/contract/ContractModel.js, line 12 Classes ContractModel ContractService Module: contract Source: eth/contract/ContractService.js, line 14 Classes ContractModel ContractService × Search results Close "},"module-contract-ContractModel.html":{"id":"module-contract-ContractModel.html","title":"Class: ContractModel","body":" EthInt Api Namespaces eth Modules accountcontracttransaction Classes account~AccountModelaccount~AccountServicecontract~ContractModelcontract~ContractServicetransaction~TransactionModeltransaction~TransactionServiceResponseServerExceptionsServerSetup Class: ContractModel contract~ ContractModel new ContractModel(&quot;db&quot;, &quot;i18n&quot;, &quot;enume&quot;, &quot;moment&quot;, &quot;config&quot;, &quot;ethHelper&quot;) Model to handle the contracts collection Parameters: Name Type Description &quot;db&quot; Object DI for database &quot;i18n&quot; Object DI for i18n &quot;enume&quot; Object DI for enum &quot;moment&quot; Object DI for moment &quot;config&quot; Object DI for config &quot;ethHelper&quot; Object DI for ethHelper Source: eth/contract/ContractModel.js, line 14 × Search results Close "},"module-contract-ContractService.html":{"id":"module-contract-ContractService.html","title":"Class: ContractService","body":" EthInt Api Namespaces eth Modules accountcontracttransaction Classes account~AccountModelaccount~AccountServicecontract~ContractModelcontract~ContractServicetransaction~TransactionModeltransaction~TransactionServiceResponseServerExceptionsServerSetup Class: ContractService contract~ ContractService new ContractService(&quot;exceptions&quot;) Service that will handle payments lifecycle Parameters: Name Type Description &quot;exceptions&quot; Object DI for exceptions Source: eth/contract/ContractService.js, line 16 × Search results Close "},"module-transaction.html":{"id":"module-transaction.html","title":"Module: transaction","body":" EthInt Api Namespaces eth Modules accountcontracttransaction Classes account~AccountModelaccount~AccountServicecontract~ContractModelcontract~ContractServicetransaction~TransactionModeltransaction~TransactionServiceResponseServerExceptionsServerSetup Module: transaction Source: eth/transaction/TransactionModel.js, line 12 Classes TransactionModel TransactionService Module: transaction Source: eth/transaction/TransactionService.js, line 14 Classes TransactionModel TransactionService × Search results Close "},"module-transaction-TransactionModel.html":{"id":"module-transaction-TransactionModel.html","title":"Class: TransactionModel","body":" EthInt Api Namespaces eth Modules accountcontracttransaction Classes account~AccountModelaccount~AccountServicecontract~ContractModelcontract~ContractServicetransaction~TransactionModeltransaction~TransactionServiceResponseServerExceptionsServerSetup Class: TransactionModel transaction~ TransactionModel new TransactionModel(&quot;db&quot;, &quot;i18n&quot;, &quot;enume&quot;, &quot;moment&quot;, &quot;config&quot;, &quot;ethHelper&quot;) Model to handle the transactions collection Parameters: Name Type Description &quot;db&quot; Object DI for database &quot;i18n&quot; Object DI for i18n &quot;enume&quot; Object DI for enum &quot;moment&quot; Object DI for moment &quot;config&quot; Object DI for config &quot;ethHelper&quot; Object DI for ethHelper Source: eth/transaction/TransactionModel.js, line 14 × Search results Close "},"module-transaction-TransactionService.html":{"id":"module-transaction-TransactionService.html","title":"Class: TransactionService","body":" EthInt Api Namespaces eth Modules accountcontracttransaction Classes account~AccountModelaccount~AccountServicecontract~ContractModelcontract~ContractServicetransaction~TransactionModeltransaction~TransactionServiceResponseServerExceptionsServerSetup Class: TransactionService transaction~ TransactionService new TransactionService(&quot;exceptions&quot;) Service that will handle payments lifecycle Parameters: Name Type Description &quot;exceptions&quot; Object DI for exceptions Source: eth/transaction/TransactionService.js, line 16 × Search results Close "},"Response.html":{"id":"Response.html","title":"Class: Response","body":" EthInt Api Namespaces eth Modules accountcontracttransaction Classes account~AccountModelaccount~AccountServicecontract~ContractModelcontract~ContractServicetransaction~TransactionModeltransaction~TransactionServiceResponseServerExceptionsServerSetup Class: Response Response new Response() Creates a new Response object. Source: struct/Response.js, line 9 Methods getCode() Get code Source: struct/Response.js, line 45 getData() Get response body Source: struct/Response.js, line 40 getMessage() Get Message Source: struct/Response.js, line 50 getStatus() Get Error Source: struct/Response.js, line 55 × Search results Close "},"ServerExceptions.html":{"id":"ServerExceptions.html","title":"Class: ServerExceptions","body":" EthInt Api Namespaces eth Modules accountcontracttransaction Classes account~AccountModelaccount~AccountServicecontract~ContractModelcontract~ContractServicetransaction~TransactionModeltransaction~TransactionServiceResponseServerExceptionsServerSetup Class: ServerExceptions ServerExceptions new ServerExceptions(&quot;i18n&quot;, &quot;restify&quot;, &quot;logger&quot;, &quot;util&quot;, &quot;exceptions&quot;) → {Object} Class that will handle Restify exceptions Parameters: Name Type Description &quot;i18n&quot; Object DI for i18n &quot;restify&quot; Object DI for restify &quot;logger&quot; Object DI for logger &quot;util&quot; Object DI for util &quot;exceptions&quot; Object DI for exceptions Source: exception/ServerExceptions.js, line 16 Returns: Returns a new ServerExceptions object. Type Object Methods createException(error,) → {object} Generates a new restify exception based on err instance Parameters: Name Type Description error, object Error object Source: exception/ServerExceptions.js, line 39 Returns: Returns a new restify exception object. Type object Example Error types: Base: ServiceException, AccessDenied: AccessDeniedException, NotFound: NotFoundException, Validation: ValidationException, Internal: InternalException getExceptionInstanceOf(error,) → {string} Returns the error type (instanceof or constructor name) Parameters: Name Type Description error, object Error object Source: exception/ServerExceptions.js, line 99 Returns: instanceof or constructor name. Type string × Search results Close "},"ServerSetup.html":{"id":"ServerSetup.html","title":"Class: ServerSetup","body":" EthInt Api Namespaces eth Modules accountcontracttransaction Classes account~AccountModelaccount~AccountServicecontract~ContractModelcontract~ContractServicetransaction~TransactionModeltransaction~TransactionServiceResponseServerExceptionsServerSetup Class: ServerSetup ServerSetup new ServerSetup('restify', 'logger', 'util', 'app_name', 'app_version') → {Object} Service that will manage the creation of new API servers Parameters: Name Type Description 'restify' Object DI for restify 'logger' Object DI for logger 'util' Object DI for util 'app_name' Object DI for app_name 'app_version' Object DI for app_version Source: server.js, line 26 Returns: Returns a new ServerSetup service object. Type Object Methods createAPIServer('config') → {Object} Parameters: Name Type Description 'config' Object Configuration object for the new API server Source: server.js, line 49 Returns: Returns a new API server. Type Object Example Example usage of createAPIServer var server = serverSetup.createAPIServer(config); × Search results Close "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
